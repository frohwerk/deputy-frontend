<div>
  <h3>
    <span>Comparing environments: {{ (from$ | async)?.name }} to</span>
    <label>
      <select [formControl]="target">
        <option value=""></option>
        <option *ngFor="let env of envs$ | async" [value]="env.id">
          {{ env.name }}
        </option>
      </select>
      <span class="dropdown-arrow"></span>
    </label>
    <span>for application {{ (app$ | async)?.name }}</span>
  </h3>
  <div class="comparison">
    <div *ngIf="left$ | async as app" class="left">
      <h3>{{(from$ | async)?.name}}</h3>
      <div ngif class="history">
        <a *ngIf="app?.created != app?.validFrom" [routerLink]="[]" [queryParams]="{before: app?.validFrom}">&lt; before</a>
        <span *ngIf="app?.created == app?.validFrom" class="disabled">&lt; before</span>
        <span *ngIf="app?.validUntil; else current">{{fromEpoch(app?.validFrom) | date:'YYYY-MM-dd HH:mm:ss.SSS'}} - {{fromEpoch(app?.validUntil) | date:'YYYY-MM-dd HH:mm:ss.SSS'}}</span>
        <ng-template #current><span>{{fromEpoch(app?.validFrom) | date:'YYYY-MM-dd HH:mm:ss.SSS'}} - Now</span></ng-template>
        <a *ngIf="app?.validUntil" [routerLink]="[]" [queryParams]="{before: app?.validUntil + 0.001}">after &gt;</a>
        <a *ngIf="app?.validUntil" [routerLink]="[]" [queryParams]="">current &gt;&gt;</a>
        <span *ngIf="!app?.validUntil" class="disabled">after &gt;</span>
        <span *ngIf="!app?.validUntil" class="disabled">current &gt;&gt;</span>
      </div>
      <ul>
        <li *ngFor="let v of app.components">
          <div class="description" [ngClass]="comparisonClass(v, right$ | async)">
            <div>{{ v.name }}</div>
            <div>Image: {{ v.image }}</div>
            <div>Last update: {{ v.deployed ? (fromEpoch(v.deployed) | date:'YYYY-MM-dd HH:mm:ss.SSS') : '' }}</div>
          </div>
          <div class="action-bar">
          </div>
        </li>
      </ul>
    </div>
    <div class="right">
      <h3>{{(to$ | async)?.name}}</h3>
      <ul  *ngIf="right$ | async as app">
        <li *ngFor="let v of app.components" [ngClass]="v.image ? '' : 'missing'">
          <div class="description" [ngClass]="comparisonClass(v, left$ | async)">
            <div>{{ v.name }}</div>
            <div>Image: {{ v.image }}</div>
            <div>Last update: {{ v.deployed ? (fromEpoch(v.deployed) | date:'YYYY-MM-dd HH:mm:ss.SSS') : '' }}</div>
          </div>
          <div class="action-bar">
          </div>
        </li>
      </ul>
    </div>
  </div>
  <!--
        GET /api/deployments?env=1234
        [
        {"name": "node-hello-world", "image": "a/b/c:1", "updated": "2021-05-10T06:16:25.380286Z"}
        ]
    -->
</div>

<a routerLinkActive="router-link-active" routerLink="/apps/{{ id$ | async }}"
  >&lt;&lt; back</a
>

<h3>TODOs</h3>
<ol>
  <li>Highlight the newer image (higher version number)</li>
</ol>
